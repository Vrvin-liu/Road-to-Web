---
title: 函数定义和调用
date: 2022-02-19 15:03:18
permalink: /pages/d65b6b/
---

## 定义函数

在JavaScript中，定义函数的方式如下：

```javascript
function abs(x) {
    if (x >= 0) {
        return x;
    } else {
        return -x;
    }
}
```

上述`abs()`函数的定义如下：

* `function`指出这是一个函数定义；
* `abs`是函数的名称；
* `(x)`括号内列出函数的参数，多个参数以`,`分隔；
* `{...}`之间的代码是函数体，可以包含干语句，甚至可以没有任何语句。

:::tip
函数体内部的语句在执行时，一旦执行到`return`时，函数就执行完毕，并将结果返回。因此，函数内部通过条件判断和循环可以实现非常复杂的逻辑。
:::

如果没有`return`语句，函数执行完毕后也会返回结果，只是结果为undefined。

由于JavaScript的函数也是一个对象，上述定义的`abs()`函数实际上是一个函数对象，而函数名abs可以视为指向该函数的变量。

因此，第二种定义函数的方式如下：

```javascript
var abs = function (x) {
    if (x >= 0) {
        return x;
    } else {
        return -x;
    }
};
```

在这种方式下，`function (x) {...}`是一个匿名函数，它没有函数名。但是，这个匿名函数赋值给了变量`abs`，所以，通过变量`abs`就可以调用该函数。

上述两种定义完全等价，注意第二种方式按照完整语法需要在函数体末尾加一个`;`，表示赋值语句结束。

## 调用函数

调用函数时，按顺序传入参数即可：

```javascript
console.log(abs(10)); // 返回10
console.log(abs(-9)); // 返回9
```

由于JavaScript允许传入任意个参数而不影响调用，因此传入的参数比定义的参数多也没有问题，虽然函数内部并不需要这些参数：

```javascript
console.log(abs(10,'1234567')); // 返回10
console.log(abs(-9,'123',null)); // 返回9
```

传入的参数比定义的少也没有问题：

```javascript
console.log(abs()); // 返回NaN
```

此时`abs(x)`函数的参数`x`将收到`undefined`，计算结果为NaN。

要避免收到`undefined`，可以对参数进行检查：

```javascript
function abs(x) {
    if (typeof x !== 'number') {
        throw 'Not a Number';
    }
    if (x >= 0) {
        return x;
    } else {
        return -x;
    }
}
```

## arguments

JavaScript还有一个免费赠送的关键字arguments，它只在函数内部起作用，并且永远指向当前函数的调用者传入的所有参数。`arguments`类似`Array`但它不是一个`Array`：

<div class="js-demo">
<div class="demo-title">
    <span>点击运行看看效果吧</span>
</div>
<textarea id="textarea1" class="textarea" maxlength="900">'use strict';
function foo(x) {
    console.log('x = ' + x); // 10
    for (var i=0; i<arguments.length; i++) {
        console.log(`arg${i}=${arguments[i]}`);
    }
}
foo(10, 20, 30);
</textarea>
<br />
<button id="run" onclick="consoleRunCode(1,true)">运行</button>
<div id="log1"></div>
</div>
<br />

利用`arguments`，你可以获得调用者传入的所有参数，也就是说，即使函数不定义任何参数还是可以拿到参数的值：

```javascript
function abs() {
    if (arguments.length === 0) {
        return 0;
    }
    var x = arguments[0];
    return x >= 0 ? x : -x;
}
console.log(abs()); // 0
console.log(abs(10)); // 10
console.log(abs(-9)); // 9
```

实际上`arguments`最常用于判断传入参数的个数。你可能会看到这样的写法：

```javascript
// foo(a[, b], c)
// 接收2~3个参数，b是可选参数，如果只传2个参数，b默认为null：
function foo(a, b, c) {
    if (arguments.length === 2) {
        // 实际拿到的参数是a和b，c为undefined
        c = b; // 把b赋值给c
        b = null; // b变为默认值
    }
    //...
}
```

要把中间的参数`b`变为‘可选’参数，就只能通过`arguments`判断，任何重新调整参数并赋值。

## rest参数

由于JavaScript函数允许接收任意个参数，于是我们就不得不用`arguments`来获所有参数：

```javascript
function foo(a, b) {
    var i,
        rest = [];
    if (arguments.length > 2) {
        for (i = 2; i < arguments.length; i++) {
            rest.push(arguments[i]);
        }
    }
    console.log('a = ' + a);
    console.log('b = ' + b);
    console.log(rest);
}
```

为了获取除了已定义参数`a`、`b`之外的参数，我们不得不用`arguments`，并且循环要从索引2开始以便排除前两个参数，这种写法很别扭，只是为了获得额外的`rest`参数，有没有更好的方法？

ES6标准引入了`rest`参数，上面的函数可以改写为：

```javascript
function foo(a, b, ...rest) {
    console.log('a = ' + a);
    console.log('b = ' + b);
    console.log(rest);
}

foo(1, 2, 3, 4, 5, 6);
// 结果：
// a = 1
// b = 2
// Array [ 3, 4, 5, 6 ]

foo(1);
// 结果：
// a = 1
// b = undefined
// Array []
```

`rest`参数只能写在最后，前面用`...`标识，从运行结果可知，传入的参数先绑定`a`、`b`，多余的参数以数组形式交给变量`rest`，所以，不在需要`arguments`我们就获取了全部参数。

如果传入的参数连正常定义的参数都没有填满，也不要紧，`rest`参数会接收一个空数组（注意不是`undefined`）。

因为`rest`参数是ES6新标准，所以你需要测试一下浏览器是否支持。请用`rest`参数编写一个`sum()`函数，接收任意个参数并返回它们的和：

<div class="js-demo">
<div class="demo-title">
    <span>根据上述补全完整代码并运行出来</span>
</div>
<textarea id="textarea2" class="textarea" maxlength="900">'use strict';
function sum(...rest) {
   ???
}
</textarea>
<br />
<button id="run" onclick="consoleRunCode(2,true)">运行</button>
<div id="log2"></div>
</div>
<br />

<!-- 
function sum(...rest) {
    let sum = 0;
    for (const a of rest) {
        sum += a;
    }
    return sum;
}

console.log(sum(1, 2, 3, 4, 5, 6, 7, 8, 9)); 
    1          2        3         4           5           6           7            8          9
1 sum = 1,  3 sum=3, 6 sum=6, 10 sum =10, 15 sum =15, 21 sum =21, 28 sum =28,  36 sum=36, 45 sum=45;

-->

## 小心你的return语句

前面我们讲到了JavaScript引擎有一个在行末自动添加分号的机制，这可能让你栽倒到`return`语句的一个大坑：

```javascript
function foo() {
    return { name: 'foo' };
}
console.log(foo()); // { name: 'foo' }
```

如果把`return`语句拆成两行：

```javascript
function foo() {
    return
        { name: 'foo' };
}

foo(); // undefined
```

要小心了，由于JavaScript引擎在行末添加自动添加分号的机制，上面的代码世界上变成了：

```javascript
function foo() {
    return; // 自动添加了分号，相当于return undefined;
        { name: 'foo' }; // 这行语句已经没法执行到了
}
```

所以正确的多行写法是：

```javascript
function foo() {
    return { // 这里不会自动加分号，因为{表示语句尚未结束
        name: 'foo'
    };
}
console.log(foo());
```

## 练习

定义一个计算圆面积的函数`area_of_circle()`，它有两个参数：
* r: 表示圆的半径；
* pi: 表示π的值，如果不传，则默认3.14

<div class="js-demo">
<div class="demo-title">
    <span>根据上述补全完整代码并运行出来</span>
</div>
<textarea id="textarea3" class="textarea" maxlength="900">'use strict';
function area_of_circle(r, pi) {
    // 修改这里的代码让返回结果为测试通过
    return 0;
}
if (area_of_circle(2) === 12.56 && area_of_circle(2, 3.1416) === 12.5664) {
    console.log('测试通过');
} else {
    console.log('测试失败');
}
</textarea>
<br />
<button id="run" onclick="consoleRunCode(3)">运行</button>
<div id="log3"></div>
</div>
<br />

小明是一个JavaScript新手，他写了一个`max()`函数，返回两个数中较大的那个：

<div class="js-demo">
<div class="demo-title">
    <span>根据上述补全完整代码并运行出来</span>
</div>
<textarea id="textarea4" class="textarea" maxlength="900">'use strict';
function max(a, b) {
    if (a > b) {
        return
                a;
    } else {
        return
                b;
    }
}
console.log(max(15, 20));
</textarea>
<br />
<button id="run" onclick="consoleRunCode(4)">运行</button>
<div id="log4"></div>
</div>
<br />

但是小明抱怨他的浏览器出问题了，无论传入什么数，`max()`函数总是返回`undefined`。请帮他指出问题并修复。